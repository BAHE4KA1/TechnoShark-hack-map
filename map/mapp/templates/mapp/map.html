<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <link rel="stylesheet" href="{% static 'mapp/map.css' %}"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Press+Start+2P&display=swap" rel="stylesheet">
    <title>Главная</title>
</head>
<body>
    <div style="display: flex; flex-direction: row; width: 30%">
        <div style="display: flex; flex-direction: column; height: 100vh; width: 85%; gap: 20px; align-items: center;">
            <form class="search-page" method="post" action="{% url 'map' %}">
                {% csrf_token %}
                <div class="search-lp">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                        <path d="M25.8741 1.12027H10.1241C8.93107 1.12157 7.78723 1.5961 6.9436 2.43973C6.09997 3.28336 5.62545 4.4272 5.62415 5.62027V30.3703C5.62545 31.5633 6.09997 32.7072 6.9436 33.5508C7.78723 34.3944 8.93107 34.869 10.1241 34.8703H25.8741C27.0672 34.869 28.211 34.3944 29.0547 33.5508C29.8983 32.7072 30.3728 31.5633 30.3741 30.3703V5.62027C30.3728 4.4272 29.8983 3.28336 29.0547 2.43973C28.211 1.5961 27.0672 1.12157 25.8741 1.12027ZM23.447 19.9999C23.9792 20.5743 24.2394 21.3471 24.1775 22.1753C24.0559 23.8249 22.798 25.1671 21.3741 25.1671C19.9503 25.1671 18.6903 23.8249 18.5701 22.1753C18.5096 21.3386 18.7677 20.5645 19.2971 19.9957C19.8266 19.4268 20.5585 19.1203 21.3741 19.1203C21.7618 19.1147 22.1464 19.19 22.5033 19.3415C22.8602 19.493 23.1816 19.7172 23.447 19.9999ZM13.4991 5.62027C13.4991 5.3219 13.6177 5.03575 13.8286 4.82477C14.0396 4.6138 14.3258 4.49527 14.6241 4.49527H21.3741C21.6725 4.49527 21.9587 4.6138 22.1696 4.82477C22.3806 5.03575 22.4991 5.3219 22.4991 5.62027C22.4991 5.91864 22.3806 6.20479 22.1696 6.41576C21.9587 6.62674 21.6725 6.74527 21.3741 6.74527H14.6241C14.3258 6.74527 14.0396 6.62674 13.8286 6.41576C13.6177 6.20479 13.4991 5.91864 13.4991 5.62027ZM26.7882 31.2021C26.7072 31.2958 26.6066 31.3707 26.4935 31.4214C26.3804 31.472 26.2575 31.4972 26.1336 31.4953H16.6147C16.4908 31.4972 16.3679 31.472 16.2548 31.4214C16.1417 31.3707 16.0411 31.2958 15.9601 31.2021C15.8722 31.0968 15.8092 30.9732 15.7756 30.8403C15.742 30.7074 15.7387 30.5686 15.766 30.4343C15.9945 29.1996 16.7068 28.1625 17.8262 27.4347C18.8204 26.7886 20.0804 26.4328 21.3741 26.4328C22.6679 26.4328 23.9279 26.7886 24.9221 27.4347C26.0415 28.1625 26.7537 29.1996 26.9823 30.4343C27.0096 30.5686 27.0063 30.7074 26.9727 30.8403C26.9391 30.9732 26.8761 31.0968 26.7882 31.2021Z" fill="#16A0AD"/>
                    </svg>
                    <input type="text" placeholder="Введите название улицы" name="search" id="search" class="search-input"/>
                </div>
                <button type="submit" class="submit-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                        <path d="M15.75 28.5C22.7916 28.5 28.5 22.7916 28.5 15.75C28.5 8.7084 22.7916 3 15.75 3C8.7084 3 3 8.7084 3 15.75C3 22.7916 8.7084 28.5 15.75 28.5Z" stroke="black" stroke-width="3" stroke-linejoin="round"/>
                        <path d="M19.9926 10.7573C18.9068 9.67155 17.4068 9 15.75 9C14.0932 9 12.5932 9.67155 11.5073 10.7573" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M24.9164 24.9164L31.2804 31.2803" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </form>

            {% for street in streets %}

            <div class="block-cars">
            <div class="car1">
                <div class="container-pb">
                    <div class="pA1">
                        <span class="textA1">{{ street.name }}</span>
                        <span class="textA1.1">{{ street.time_start }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-value" style="--cur-value: {{ street.traffic_value }}; --bg-color: {{ street.traffic_color }}">
                        </div>
                    </div>
                    <div class="pA1-1">
                        <div class="circle" style="--bg-color: {{ street.traffic_color }};">
                            <span class="num" style="--bg-color: {{ street.traffic_color }};">{{ street.traffic_value }}</span>
                        </div>
                        <div class="time">
                            <span class="time-val">{{ street.time_end }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
            </div>
        <div style="padding-top: 25px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start;">
                    <a href="#"><div style="display: flex; width: 64px; height: 64px; flex-shrink: 0; border-radius: 12px; border: 2px solid #000; background: #FFF; align-items: center; justify-content: center;margin-bottom: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
                            <path d="M8 24H40M8 12H40M8 36H40" stroke="black" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg></div></a>
                    <a href="/"><div style="display: flex; width: 64px; height: 64px; flex-shrink: 0; border-radius: 12px; border: 2px solid #000; background: #FFF; align-items: center; justify-content: center; margin-bottom: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <path d="M9 42V18L4 22L24 6L44 22L39 18V42H9Z" stroke="black" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M19 29V42H29V29H19Z" stroke="black" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M9 42H39" stroke="black" stroke-width="2" stroke-linecap="round"/>
                      </svg></div></a>
                    <a href="/map/"><div style="display: flex; width: 64px; height: 64px; flex-shrink: 0; border-radius: 12px; border: 2px solid #000; background: #FFF; align-items: center; justify-content: center; margin-bottom: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <g clip-path="url(#clip0_371_818)">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M47.451 0.338591C47.6228 0.479399 47.7611 0.656588 47.856 0.857366C47.951 1.05814 48.0001 1.2775 48 1.49959V43.4996C47.9998 43.8462 47.8795 44.1821 47.6597 44.4501C47.4398 44.7181 47.1339 44.9017 46.794 44.9696L31.794 47.9696C31.5999 48.0082 31.4001 48.0082 31.206 47.9696L16.5 45.0296L1.794 47.9696C1.57647 48.0131 1.352 48.0078 1.13676 47.954C0.921528 47.9003 0.720888 47.7995 0.549298 47.6589C0.377708 47.5183 0.23944 47.3414 0.144455 47.141C0.0494705 46.9405 0.000133958 46.7214 0 46.4996L0 4.49959C0.000209346 4.15295 0.120468 3.81709 0.34033 3.5491C0.560192 3.2811 0.866085 3.09753 1.206 3.02959L16.206 0.0295914C16.4001 -0.00920082 16.5999 -0.00920082 16.794 0.0295914L31.5 2.96959L46.206 0.0295914C46.4235 -0.0141612 46.6479 -0.00914062 46.8632 0.0442914C47.0785 0.0977234 47.2792 0.198237 47.451 0.338591ZM30 5.72959L18 3.32959V42.2696L30 44.6696V5.72959ZM33 44.6696L45 42.2696V3.32959L33 5.72959V44.6696ZM15 42.2696V3.32959L3 5.72959V44.6696L15 42.2696Z" fill="black"/>
                        </g>
                        <defs>
                          <clipPath id="clip0_371_818">
                            <rect width="48" height="48" fill="white"/>
                          </clipPath>
                        </defs>
                      </svg></div></a>
                    <a href="/analitics/"><div style="display: flex; width: 64px; height: 64px; flex-shrink: 0; border-radius: 12px; border: 2px solid #000; background: #FFF; align-items: center; justify-content: center; margin-bottom: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <path d="M43.4199 14.58C43.234 14.3925 43.0127 14.2438 42.769 14.1422C42.5253 14.0407 42.2639 13.9884 41.9999 13.9884C41.7359 13.9884 41.4744 14.0407 41.2307 14.1422C40.987 14.2438 40.7658 14.3925 40.5799 14.58L27.9999 27.18L19.4199 18.58C19.234 18.3925 19.0127 18.2438 18.769 18.1422C18.5253 18.0407 18.2639 17.9884 17.9999 17.9884C17.7359 17.9884 17.4744 18.0407 17.2307 18.1422C16.987 18.2438 16.7658 18.3925 16.5799 18.58L4.57988 30.58C4.39242 30.7659 4.24363 30.9871 4.1421 31.2308C4.04056 31.4746 3.98828 31.736 3.98828 32C3.98828 32.264 4.04056 32.5254 4.1421 32.7692C4.24363 33.0129 4.39242 33.2341 4.57988 33.42C4.7658 33.6075 4.98701 33.7562 5.23072 33.8578C5.47444 33.9593 5.73585 34.0116 5.99988 34.0116C6.2639 34.0116 6.52531 33.9593 6.76903 33.8578C7.01275 33.7562 7.23395 33.6075 7.41988 33.42L17.9999 22.82L26.5799 31.42C26.7658 31.6075 26.987 31.7562 27.2307 31.8578C27.4744 31.9593 27.7359 32.0116 27.9999 32.0116C28.2639 32.0116 28.5253 31.9593 28.769 31.8578C29.0128 31.7562 29.234 31.6075 29.4199 31.42L43.4199 17.42C43.6073 17.2341 43.7561 17.0129 43.8577 16.7692C43.9592 16.5254 44.0115 16.264 44.0115 16C44.0115 15.736 43.9592 15.4746 43.8577 15.2308C43.7561 14.9871 43.6073 14.7659 43.4199 14.58Z" fill="black"/>
                      </svg></div></a>
                    <a href="/request/"><div style="display: flex; width: 64px; height: 64px; flex-shrink: 0; border-radius: 12px; border: 2px solid #000; background: #FFF; align-items: center; justify-content: center; margin-bottom: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <path d="M41 10H13V44H41V10Z" stroke="black" stroke-width="4" stroke-linejoin="round"/>
                        <path d="M35 10V4H8C7.44772 4 7 4.44772 7 5V38H13" stroke="black" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21 22H33" stroke="black" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21 30H33" stroke="black" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg></div></a>
        </div>
    </div>
    <div id="map" style="width: 70%; height: 100vh;"></div>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=1be171c5-c5e2-451f-8ca9-6e9d39152b98" type="text/javascript"></script>
    <script>
        ymaps.ready(function () {
        // Создаем карту
        var map = new ymaps.Map('map', {
            center: [45.0448, 38.976],
            zoom: 13,
            });

        var actualProvider = new ymaps.traffic.provider.Actual({}, { infoLayerShown: true });
        actualProvider.setMap(map);

        // Пример запроса, переданного из Python (в переменную `req`)
        var searchQuery = "{{ req }}"; // Строка запроса передается из Python в JavaScript

        // Функция для выполнения поиска на карте
        function searchLocation(query) {
            ymaps.geocode(query).then(function (res) {
                var firstGeoObject = res.geoObjects.get(0);
                if (firstGeoObject) {
                    var coordinates = firstGeoObject.geometry.getCoordinates();

                    // Центрируем карту на найденные координаты
                    map.setCenter(coordinates, 16);

                    // Добавляем метку на найденном месте
                    var placemark = new ymaps.Placemark(coordinates, {
                        balloonContent: coordinates
                    }, {
                        preset: 'islands#redDotIcon'
                    });

                    map.geoObjects.add(placemark);
                } else {
                    alert('Адрес не найден!');
                }
            });
        }

        // Выполняем поиск на карте с переданным запросом
        searchLocation(searchQuery);
    });
    </script>

</body>
</html>